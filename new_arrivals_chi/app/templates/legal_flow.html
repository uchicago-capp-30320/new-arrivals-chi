<!--
Project: new_arrivals_chi
File name: legal_flow.html
Associated Files:
    base.html, main.py

Decision tree for legal resources.
-->

{% extends "base.html" %}

{% block content %}
<div id="buttonContainer"></div>
<style>
    .button-group {
        display: flex; /* Displays the button group as a flex container */
        flex-direction: row; /* Arranges the button wrappers in a row */
        flex-wrap: wrap; /* Allows the button wrappers to wrap to the next line if needed */
        justify-content: center; /* Centers the button wrappers horizontally */
        align-items: stretch; 
        margin-bottom: 20px; /* Adds spacing below the button group */
    }

    .button-wrapper {
        display: flex; /* Displays each button wrapper as a flex container */
        flex-direction: column; /* Arranges the button and description vertically */
        align-items: stretch;
        margin: 10px; /* Adds spacing around each button wrapper */
        max-width: 250px; /* Sets a maximum width for the button wrapper */
        flex: 1;
    }

    .button-wrapper button {
        margin-bottom: 5px; /* Adds spacing below each button */
        width: 100%; /* Makes the button fill the entire width of the wrapper */
        white-space: normal; /* Allows the button text to wrap to the next line */
        word-wrap: break-word; /* Breaks long words to the next line if needed */
        text-align: center; /* Centers the button text horizontally */
        padding: 10px; /* Adds padding within the button */
        font-size: 16px; /* Sets the font size of the button text */
        min-height: 80px; /* Sets a minimum height for the button */
    }

    .button-wrapper ul {
        margin: 0;
        padding-left: 20px;
        text-align: left;
        font-size: 12px;
    }

    #buttonContainer > p {
        font-size: 36px; /* Sets the font size of the title */
        text-align: center; /* Centers the title text horizontally */
        margin-bottom: 20px; /* Adds spacing below the title */
    }

</style>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Define the options object with the button structure and properties
    const options = {
        legal_start: {
            key: "legal",
            header: "what_help", 
            children: {
                work_auth: {
                    key: "work_auth",
                    header: "work_auth_question", 
                    children: {
                        tps: { key: "tps", header: "tps_header", desc: "tps_desc", children: { 
                            option1: { key: "tps_info", link: "/tps_info" },
                            option2: { key: "tps_apply", link: "/tps_apply" }
                        }},
                        vttc: { key: "vttc", header: "vttc_header", desc: "vttc_desc", children: { 
                            option1: { key: "vttc_info", link: "/vttc_info" },
                            option2: { key: "vttc_apply", link: "/vttc_apply" }
                        }},
                        asylum: { key: "asylum", header: "asylum_header", desc: "asylum_desc", children: { 
                            option1: { key: "asylum_info", link: "/asylum_info" },
                            option2: { key: "asylum_apply", link: "/asylum_apply" }
                        }},
                        parole: { key: "parole", header: "parole_header", desc: "parole_desc", children: { 
                            option1: { key: "parole_info", link: "/parole_info" },
                            option2: { key: "parole_apply", link: "/parole_apply" }
                        }},
                        other: { key: "other", header: "other_header", desc: "other_desc", children: { 
                            option1: { key: "undocumented", link: "/undocumented_resources" },
                            option2: { key: "lawyers", link: "/legal_help" }
                        }},
                    }
                },
                work_rights: { key: "work_rights", link: "/work_rights" },
                renters_rights: { key: "renters_rights", link: "/renters_rights" },
                something_else: { key: "something_else", link: "/legal_general" }
            }
        }
    };

    // Get the language-specific translations from the server-side template
    let languageData = {{ translations[language].legal_start | tojson | safe }};
    
    // Array to store previous options for the back button functionality
    let previousOptions = [];

    // Function to create buttons based on the current options
    function createButtons(currentOptions) {
        // Clear the button container
        $('#buttonContainer').empty();
        
        // Get the header text from the language data or use a default value
        const headerText = currentOptions.header && languageData[currentOptions.header]
            ? languageData[currentOptions.header]
            : 'Select an option';
        
        // Append the header text to the button container
        $('#buttonContainer').append($('<p>').text(headerText));

        // Create a button group element
        let buttonGroup = $('<div>').addClass('button-group');

        // Check if the current options have children
        if (currentOptions.children) {
            // Iterate over each child option
            Object.keys(currentOptions.children).forEach(key => {
                const childOption = currentOptions.children[key];
                
                // Get the button text from the language data or use a default value
                const btnText = languageData[childOption.key] || 'Key not found';
                
                // Get the button description from the language data and replace newline characters with <br> tags
                const btnDesc = childOption.desc && languageData[childOption.desc] 
                    ? languageData[childOption.desc].split('\n').map(item => `<li>${item}</li>`).join('') 
                    : '';
                        
                // Create a button element with the button text and click event handler
                let btn = $('<button>').text(btnText).on('click', () => {
                    if (childOption.children) {
                        // If the child option has children, push the current options to the previous options array and create buttons for the child option
                        previousOptions.push(currentOptions);
                        createButtons(childOption);
                    } else if (childOption.link) {
                        // If the child option has a link, navigate to the link
                        window.location.href = childOption.link;
                    }
                });
                
                // Create a description element with the button description
                let desc = $('<ul>').html(btnDesc);

                // Create a button wrapper element and append the button and description elements to it
                let buttonWrapper = $('<div>').addClass('button-wrapper').append(btn).append(desc);

                // Append the button wrapper to the button group
                buttonGroup.append(buttonWrapper);
            });

            // Append the button group to the button container
            $('#buttonContainer').append(buttonGroup);

            // Check if there are previous options
            if (previousOptions.length > 0) {
                // Create a back button element with a click event handler
                let backBtn = $('<button>').text('Back').on('click', () => {
                    // Pop the previous options from the array and create buttons for them
                    const prevOptions = previousOptions.pop();
                    createButtons(prevOptions);
                });
                
                // Append the back button to the button container
                $('#buttonContainer').append(backBtn);
            }
        } else {
            // If the current options have no children, log an error message to the console
            console.error("No children options found for:", currentOptions);
        }
    }

    // Document ready function
    $(document).ready(function() {
        // Create buttons for the initial legal_start options
        createButtons(options.legal_start);
    });
</script>

{% endblock %}